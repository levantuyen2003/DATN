<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>META</title>
    <link rel="stylesheet" th:href="@{/web/dist/css/style.css}">
    <link rel="stylesheet" th:href="@{/web/libs/fontawesome-free-6.4.2-web/css/all.css}">
    <link rel="stylesheet" th:href="@{/web/libs/bootstrap-5.3.2-dist/bootstrap-5.3.2-dist/css/bootstrap.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>
<body>
    <div class="wapper">
        <header>
            <div class="header">
                <div class="logo">
                    <a href="/page" class="text-white text-decoration-none">META</a>
                </div>
                <div class="search">
                    <div class="input-group">
                        <input id="search1" type="text" class="form-control" placeholder="Tìm kiếm...">
                        <button id="search2" class="btn btn-primary" type="button">Tìm kiếm</button>
                    </div>
                </div>
                <div class="cart">
                    <a href="#" class="text-white text-decoration-none"><i class="fa-solid fa-cart-shopping"></i> Giỏ hàng</a>
                    <div class="cart-box">
                        <ul class="cart-items">
                        <li>
                            <img src="img/product1.jpg" alt="">
                            <div class="info">
                            <p>Sản phẩm A</p>
                            <span>1 x 150.000đ</span>
                            </div>
                        </li>
                        <li>
                            <img src="img/product2.jpg" alt="">
                            <div class="info">
                            <p>Sản phẩm B</p>
                            <span>2 x 200.000đ</span>
                            </div>
                        </li>
                        </ul>
                        <div class="cart-total">Tổng: <strong>550.000đ</strong></div>
                        <a href="#" class="btn-view-cart">Xem giỏ hàng</a>
                    </div>
                </div>
                <div class="hotline">
                    <a href="#" class="text-white text-decoration-none"> <i class="fa-solid fa-phone"></i>
                    Hotline</a>
                    <div class="hotline-box">
                        <p><strong>1900 1234</strong></p>
                        <p>Hỗ trợ 24/7</p>
                        <p>(08:00 - 21:00)</p>
                    </div>
                </div>
                <div class="login">
                    <a href="#" class="text-white text-decoration-none"><i class="fa-solid fa-user-tie"></i>
                    Đăng nhập</a>
                    <div class="login-box">
                        <ul>
                            <li><a href="#">Tra cứu đơn hàng</a></li>
                            <li><a href="#">Lịch sử mua hàng</a></li>
                            <li><a href="#">Lấy mã khuyến mãi</a></li>
                            <li><a href="#">Sản phẩm đã xem</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>

        <!-- Bootstrap Container -->
        <div class="container" style="max-width: 1220px;">
            <div class="row">
                <!-- Cột trái: Thông tin nhận hàng -->
                <form action="/thongtindathang" method="post" class="col-lg-6">
                    <div>
                        <div class="add-list">
                            <div class="add-title">
                                <h2><i class="fa-solid fa-location-dot"></i> Địa chỉ nhận hàng</h2>
                            </div>
                            <div class="lb-ip">
                                <div class="rg-title mb-3">
                                    <div class="tx-lb mb-1">
                                        <label for="">Họ và tên:</label>
                                    </div>
                                    <div class="tx-ip">
                                        <input type="text" name="tennguoidat" class="form-control" placeholder="Họ và tên">
                                    </div>
                                </div>

                                <div class="rg-title mb-3">
                                    <div class="tx-lb mb-1">
                                        <label for="">Số điện thoại:</label>
                                    </div>
                                    <div class="tx-ip">
                                        <input type="text" name="sodienthoai" class="form-control" placeholder="Nhập số điện thoại">
                                    </div>
                                </div>

                            </div>
                            <div class="adds-tt mb-3">
                                <div class="tx-lb mb-2">
                                    <label for="">Địa chỉ:</label>
                                </div>
                                <div class="ip-adds row g-2 ">
                                    <div class="ccs col-4">
                                        <input type="text" name="tinhtp" class="form-control" placeholder="Tỉnh/Thành phố">
                                    </div>
                                    <div class="ccs col-4 ">
                                        <input type="text" name="quanhuyen" class="form-control" placeholder="Quận/Huyện">
                                    </div>
                                    <div class="ccs col-4 ">
                                        <input type="text" name="xathon" class="form-control" placeholder="Phường/Xã">
                                    </div>
                                </div>
                                <div class="num mt-2">
                                    <input type="text" name="diachi" class="form-control" placeholder="Số nhà">
                                </div>
                            </div>
                            <div class="shipp mb-3">
                                <h3><i class="fa-solid fa-money-check-dollar"></i> Hình thức thanh toán:</h3>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" value="COD" name="thanhtoan" id="cod" checked>
                                    <label class="form-check-label" for="cod"> Nhận hàng thanh toán </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio"  name="thanhtoan" id="bank">
                                    <label class="form-check-label" value="BANK" for="bank"> Chuyển khoản qua Ngân hàng, quét mã QR </label>
                                </div>
                            </div>
                            <div class="oder-new text-center">
                                <button class="btn btn-success">
                                    <i class="fa-solid fa-cart-plus"></i> Gửi đơn hàng
                                </button>
                            </div>
                        </div>
                    </div>


                    <div th:each="obj, iterStat : ${productOrder}">
                        <input type="hidden" th:name="'items[' + ${iterStat.index} + '].tensanpham'" th:value="${obj.tensanpham}" />
                        <input type="hidden" th:name="'items[' + ${iterStat.index} + '].gia'" th:value="${obj.gia}" />
                        <!-- Số lượng (có thể để người dùng nhập nếu muốn) -->
<!--                        <input type="hidden" th:name="'items[' + ${iterStat.index} + '].soluong'" value="1" />-->
                        <input type="hidden"
                               th:name="'items[' + ${iterStat.index} + '].soluong'"
                               th:id="'hiddenQuantity' + ${iterStat.index}"
                               class="form-control text-center quantityInput"
                               style="font-size: 13px; width: 60px;"
                               value="0" step="1" min="1" max="10"
                               th:attr="data-price=${obj.gia}" />


                    </div>

                    <!-- Gửi tổng tiền (dùng JS hoặc xử lý trên server nếu cần) -->
                    <input type="hidden" name="tongTien" id="tongTienInput" value="0" />



                </form>
                <!-- Cột phải: Danh sách sản phẩm -->
                <div class="col-lg-6">
                    <div class="pro-list">
                        <div class="pl-tt">
                            <h2><i class="fa-solid fa-cart-plus"></i> Danh sách sản phẩm</h2>
                        </div>
                        <div class="pro-main">
                            <!-- <div class="pm-tt mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkAll" checked>
                                    <label class="form-check-label" for="checkAll"> Chọn tất cả </label>
                                </div>
                            </div> -->

                            <div class="pm-main" th:each="obj : ${productOrder}">
                                <div class="pm-ck">
                                    <!--                            <input class="form-check-input" type="checkbox" value="" id="flexCheckChecked" >-->
                                    <img th:src="${obj.hinhanh}" width="80px" height="80px" alt="">
                                </div>
                                <div class="pm-name">
                                    <span th:text="${obj.tensanpham}" style="font-size: 13px;"></span>
                                </div>
                                <div class="pm-price">
                                    <span class="text-danger fw-bold"
                                          th:text="${#numbers.formatDecimal(obj.gia, 0, 'COMMA', 0, 'POINT')} + ' đ'"
                                          style="color: red; font-weight: bold; font-size: 16px;">
    0 đ
</span>
<!--                                    <span th:text="${obj.gia}" ></span>-->
                                    <span style="color: red; font-weight: bold; font-size: 18px;">đ</span>
                                </div>
                                <div class="pm-qty">
                                    <div class="dpv-amg">
                                        <span class="quantity-wrapper">
                                            <button type="button" onclick="changeQuantity(this, -1)">−</button>
                                            <input type="text"
                                                   class="form-control text-center quantityInput"
                                                   style="font-size: 13px; width: 60px;"
                                                   value="1" step="1" min="1" max="10"
                                                   th:attr="data-price=${obj.gia}">

                                            <button type="button" onclick="changeQuantity(this, 1)">+</button>
                                        </span>
                                    </div>
                                    <div class="pm-del">
                                        <a href="">
                                            <i class="fa-solid fa-trash-can"></i>
                                            Xóa
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="summary mt-3">
                                <div class="sy-tienhang d-flex justify-content-between">
                                    <div class="sy-tt">Tiền hàng</div>
                                    <div class="sy-vl" id="tienHang">0đ</div>
                                </div>
                                <div class="sy-vanchuyen d-flex justify-content-between">
                                    <div class="vc-tt">Vận chuyển</div>
                                    <div class="vc-vl">Miễn phí</div>
                                </div>
                                <div class="tt-tongtien d-flex justify-content-between fw-bold text-danger">
                                    <div class="tt-tt">Tổng tiền</div>
                                    <div class="tt-vl" id="tongTien">0đ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- /.row -->
        </div> <!-- /.container -->
    </div>

    <script>
        function changeQuantity(button, delta) {
            const input = button.parentElement.querySelector('.quantityInput');
            let value = parseInt(input.value) || 1;
            value = Math.max(1, value + delta); // không cho nhỏ hơn 1
            input.value = value;
            updateTotal();
        }

        function formatCurrency(number) {
            return number.toLocaleString('vi-VN');
        }

        function parseCurrency(value) {
            return parseInt(value.replace(/[^\d]/g, ''));
        }

        function updateTotalPrice() {
            const prices = document.querySelectorAll('.pm-price span:first-child');
            let total = 0;

            prices.forEach(span => {
                const price = parseCurrency(span.textContent);
                total += price;
            });

            document.querySelector('.sy-vl').textContent = formatCurrency(total) + 'đ';
            document.querySelector('.tt-vl').textContent = formatCurrency(total) + 'đ';
        }

        document.addEventListener("DOMContentLoaded", function () {
            updateTotalPrice();
        });
    </script>


    <script>
        function changeQuantity(button, change) {
            const input = button.parentElement.querySelector('.quantityInput');
            let currentValue = parseInt(input.value);
            const min = parseInt(input.min);
            const max = parseInt(input.max);

            let newValue = currentValue + change;
            if (newValue >= min && newValue <= max) {
                input.value = newValue;
                updateTotal();
            }
        }

        function updateTotal() {
            const quantityInputs = document.querySelectorAll('.quantityInput');
            let total = 0;

            quantityInputs.forEach(input => {
                const quantity = parseInt(input.value);
                const price = parseFloat(input.getAttribute('data-price'));
                if (!isNaN(quantity) && !isNaN(price)) {
                    total += quantity * price;
                }
            });

            const formattedTotal = total.toLocaleString('vi-VN') + 'đ';
            document.getElementById('tienHang').innerText = formattedTotal;
            document.getElementById('tongTien').innerText = formattedTotal;
        }

        // Gọi khi trang được load lần đầu
        window.addEventListener('DOMContentLoaded', () => {
            updateTotal();
        });
    </script>

<!--    lưu tổng tieenf vào db-->
    <script>
        function updateTongTienInput() {
            let total = 0;
            const quantityInputs = document.querySelectorAll('.quantityInput');
            quantityInputs.forEach(input => {
                const gia = parseInt(input.getAttribute('data-price'));
                const soluong = parseInt(input.value);
                if (!isNaN(gia) && !isNaN(soluong)) {
                    total += gia * soluong;
                }
            });

            // Cập nhật vào input ẩn
            const tongTienInput = document.getElementById('tongTienInput');
            tongTienInput.value = total;

            // Đồng thời cập nhật lên UI nếu muốn
            document.getElementById('tienHang').innerText = total.toLocaleString('vi-VN') + 'đ';
            document.getElementById('tongTien').innerText = total.toLocaleString('vi-VN') + 'đ';
        }

        // Gọi lại hàm mỗi khi người dùng thay đổi số lượng
        document.querySelectorAll('.quantityInput').forEach(input => {
            input.addEventListener('change', updateTongTienInput);
        });

        // Gọi lại trước khi form submit
        document.querySelector('form').addEventListener('submit', function (e) {
            updateTongTienInput();
        });

        // Gọi ban đầu khi trang tải
        window.addEventListener('load', updateTongTienInput);
    </script>


    <hr>
    <footer>

        <div class="container mt-4">
            <div class="row ft-end">
                <!-- Cột trái -->
                <div class="col-md-6 ftt1">
                    <div>Công ty cổ phần mạng trực tuyến META</div>
                    <div>Trên 18 năm Uy tín cung cấp Dịch vụ Bán hàng & Thu tiền tại nhà toàn quốc</div>
                    <div>
                        Giấy chứng nhận ĐKDN số <b>0102196915</b> do Sở KH&ĐT TP. Hà Nội cấp ngày 29/03/2007.
                    </div>
                </div>

                <!-- Cột phải -->
                <div class="col-md-6 ftt2">
                    <span><strong>HÀ NỘI:</strong>  56 Duy Tân, P. Dịch Vọng Hậu, Q. Cầu Giấy</span><br>
                    <span><strong>- Điện thoại:</strong><a href="tel:02435686969"> (024) 3568 6969</a></span>
                    <div><b>Email:</b> info@meta.vn</div>
                </div>
            </div>
        </div>

    </footer>
</body>


